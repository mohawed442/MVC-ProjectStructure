<div align="center">

# ğŸ“ Signup System - Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„

### *Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ OTP ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ*

<img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png" width="200" alt="Signup System" />

[![Branch](https://img.shields.io/badge/Branch-signup-success?style=for-the-badge)](https://github.com/your-repo/tree/signup)
[![Status](https://img.shields.io/badge/Status-Production_Ready-success?style=for-the-badge)](https://github.com/your-repo)
[![Version](https://img.shields.io/badge/Version-2.0.0-orange?style=for-the-badge)](https://github.com/your-repo)

</div>

---

## ğŸ“– Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

- [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©](#-Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)
- [Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ÙƒØ§Ù…Ù„Ø©](#-Ù‡ÙŠÙƒÙ„ÙŠØ©-Ø§Ù„Ù…Ø´Ø±ÙˆØ¹-Ø§Ù„ÙƒØ§Ù…Ù„Ø©)
- [Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø´Ø±Ø­](#-Ø§Ù„ÙƒÙˆØ¯-Ø§Ù„ÙƒØ§Ù…Ù„-Ù…Ø¹-Ø§Ù„Ø´Ø±Ø­)
- [Ø¢Ù„ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©](#-Ø¢Ù„ÙŠØ©-Ø§Ù„Ø¹Ù…Ù„-Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©)
- [Ø¯Ù„ÙŠÙ„ Git Ø§Ù„Ù…ÙØµÙ„](#-Ø¯Ù„ÙŠÙ„-git-Ø§Ù„Ù…ÙØµÙ„)
- [Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©](#-Ø§Ù„Ù…Ù„ÙØ§Øª-Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©)
- [Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…](#-Ø§Ø®ØªØ¨Ø§Ø±-Ø§Ù„Ù†Ø¸Ø§Ù…)
- [Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„](#-Ø­Ù„-Ø§Ù„Ù…Ø´Ø§ÙƒÙ„)

---

## ğŸ¯ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

<div align="center">
<img src="https://user-images.githubusercontent.com/74038190/229223156-0cbdaba9-3128-4d8e-8719-b6b4cf741b67.gif" width="300" alt="Registration">
</div>

### **Ù†Ø¸Ø§Ù… Signup Ù…ØªÙ‚Ø¯Ù… ÙŠØªØ¶Ù…Ù†:**

âœ… **ØªØ³Ø¬ÙŠÙ„ Ø´Ø§Ù…Ù„** - 8 Ø­Ù‚ÙˆÙ„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©  
âœ… **ØªØ´ÙÙŠØ± Ù…ØªÙ‚Ø¯Ù…** - BCrypt Ù„Ù„ÙƒÙ„Ù…Ø§Øª + CryptoJS Ù„Ù„Ù‡ÙˆØ§ØªÙ  
âœ… **OTP System** - Ø±Ù…Ø² ØªØ­Ù‚Ù‚ Ù…Ø¤Ù‚Øª ÙŠØ±Ø³Ù„ Ù„Ù„Ø¨Ø±ÙŠØ¯  
âœ… **Event-Driven** - Ù†Ø¸Ø§Ù… Events Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯  
âœ… **Validation** - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸  
âœ… **Error Handling** - Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ù„Ø£Ø®Ø·Ø§Ø¡  
âœ… **Logger** - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª  
âœ… **JWT Tokens** - 3 Ø£Ù†ÙˆØ§Ø¹ Ù…Ø®ØªÙ„ÙØ© Ù…Ù† Tokens  
âœ… **Secure Cookies** - Ø­ÙØ¸ Ø¢Ù…Ù† Ù„Ù„Ù€ Tokens

---

## ğŸ“ Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ÙƒØ§Ù…Ù„Ø©

<div align="center">
<img src="https://user-images.githubusercontent.com/74038190/212257454-16e3712e-945a-4ca2-b238-408ad0bf87e6.gif" width="80" alt="Project Structure">
</div>

```
ğŸ“¦ E-commerce-auth/
â”ƒ
â”£ ğŸ“‚ src/
â”ƒ â”ƒ
â”ƒ â”£ ğŸ“‚ controllers/
â”ƒ â”ƒ â”— ğŸ“œ auth.controller.js        â­ Ø§Ù„ÙƒÙ†ØªØ±ÙˆÙ„Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
â”ƒ â”ƒ
â”ƒ â”£ ğŸ“‚ routes/
â”ƒ â”ƒ â”— ğŸ“œ auth.routes.js            ğŸ›£ï¸ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
â”ƒ â”ƒ
â”ƒ â”£ ğŸ“‚ models/
â”ƒ â”ƒ â”£ ğŸ“œ user.model.js              ğŸ‘¤ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
â”ƒ â”ƒ â”— ğŸ“œ OTP.model.js               ğŸ” Ù†Ù…ÙˆØ°Ø¬ OTP
â”ƒ â”ƒ
â”ƒ â”£ ğŸ“‚ middlewares/
â”ƒ â”ƒ â”— ğŸ“œ validate.middleware.js    âœ”ï¸ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
â”ƒ â”ƒ
â”ƒ â”£ ğŸ“‚ validators/
â”ƒ â”ƒ â”— ğŸ“œ auth.validator.js         ğŸ“‹ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚
â”ƒ â”ƒ
â”ƒ â”£ ğŸ“‚ utils/
â”ƒ â”ƒ â”£ ğŸ“œ api-error.js               âŒ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
â”ƒ â”ƒ â”£ ğŸ“œ api-response.js            âœ… ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª
â”ƒ â”ƒ â”£ ğŸ“œ logger.js                  ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
â”ƒ â”ƒ â”£ ğŸ“œ generate-code.js           ğŸ”¢ ØªÙˆÙ„ÙŠØ¯ OTP
â”ƒ â”ƒ â”£ ğŸ“œ email-event.js             ğŸ“§ Ù†Ø¸Ø§Ù… Events Ù„Ù„Ø¨Ø±ÙŠØ¯
â”ƒ â”ƒ â”— ğŸ“œ jwt.js                     ğŸ« Ø¥Ø¯Ø§Ø±Ø© JWT Tokens
â”ƒ â”ƒ
â”ƒ â”— ğŸ“œ app.js                        ğŸš€ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
â”ƒ
â”£ ğŸ“œ .env                             âš™ï¸ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©
â”£ ğŸ“œ package.json
â”— ğŸ“œ README.md
```

---

## ğŸ® Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø´Ø±Ø­

### **1ï¸âƒ£ Ø§Ù„Ù…Ø³Ø§Ø± (Route)** - `auth.routes.js`

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/2920/2920277.png" width="80" alt="Routes">
</div>

```javascript
import express from "express";
import { validate } from "../middlewares/validate.middleware.js";
import { signupSchema } from "../validators/auth.validator.js";
import { signup } from "../controllers/auth.controller.js";

const router = express.Router();

// ğŸ“ Ù…Ø³Ø§Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹ Validation Middleware
router.post("/signup", validate(signupSchema, "body"), signup);

export default router;
```

**ğŸ“Œ Ø§Ù„Ø´Ø±Ø­:**
- `validate()` - Middleware Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒÙ†ØªØ±ÙˆÙ„Ø±
- `signupSchema` - Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ù„Ù„ØªØ­Ù‚Ù‚ (Ù…Ù† Joi Ø£Ùˆ Yup)
- `"body"` - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† `req.body`

---

### **2ï¸âƒ£ Ø§Ù„ÙƒÙ†ØªØ±ÙˆÙ„Ø± (Controller)** - `auth.controller.js`

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/2920/2920235.png" width="80" alt="Controller">
</div>

```javascript
import bcrypt from "bcryptjs";
import CryptoJS from "crypto-js";
import { emailEvent } from "../utils/email-event.js";
import ApiError from "../utils/api-error.js";
import ApiResponse from "../utils/api-response.js";
import logger from "../utils/logger.js";
import generateCode from "../utils/generate-code.js";
import {
  generateOTPToken,
  generateAccessToken,
  generateRefreshToken,
  verifyOTPToken,
} from "../utils/jwt.js";
import User from "../models/user.model.js";
import OTP from "../models/OTP.model.js";

export const signup = async (req, res, next) => {
  // ========================================
  // ğŸ“¥ Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Request
  // ========================================
  const {
    userName,      // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ±ÙŠØ¯
    fullName,      // Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„
    email,         // Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    password,      // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    phoneNumber,   // Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
    gender,        // Ø§Ù„Ø¬Ù†Ø³
    bio,           // Ù†Ø¨Ø°Ø© ØªØ¹Ø±ÙŠÙÙŠØ©
    DOB,           // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Date of Birth)
  } = req.body;

  // ========================================
  // ğŸ” Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹
  // ========================================
  const checkUser = await User.findOne({ email });
  if (checkUser) {
    // Ø¥Ø±Ø¬Ø§Ø¹ Ø®Ø·Ø£ 409 Conflict
    return next(new ApiError("This email is already registered", 409));
  }

  // ========================================
  // ğŸ” Ø§Ù„Ø®Ø·ÙˆØ© 3: ØªØ´ÙÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
  // ========================================
  const hashPassword = await bcrypt.hash(
    password,
    parseInt(process.env.SALT) // Ø¹Ø¯Ø¯ Salt Rounds Ù…Ù† .env
  );

  // ========================================
  // ğŸ”’ Ø§Ù„Ø®Ø·ÙˆØ© 4: ØªØ´ÙÙŠØ± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
  // ========================================
  const encryptedPhone = CryptoJS.AES.encrypt(
    phoneNumber,
    process.env.ENCRYPT // Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ´ÙÙŠØ± Ù…Ù† .env
  ).toString();

  // ========================================
  // ğŸ’¾ Ø§Ù„Ø®Ø·ÙˆØ© 5: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  // ========================================
  const user = await User.create({
    userName,
    fullName,
    email,
    password: hashPassword,        // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø´ÙØ±Ø©
    phoneNumber: encryptedPhone,   // Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø´ÙØ±
    gender,
    bio,
    date_of_birth: DOB,
  });

  // ========================================
  // ğŸ”¢ Ø§Ù„Ø®Ø·ÙˆØ© 6: ØªÙˆÙ„ÙŠØ¯ Ø±Ù…Ø² OTP
  // ========================================
  const code = generateCode(); // Ù…Ø«Ø§Ù„: 123456 (6 Ø£Ø±Ù‚Ø§Ù…)
  
  // Ø­ÙØ¸ Ø§Ù„Ù€ OTP ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  await OTP.create({ 
    userId: user._id, 
    code 
  });

  // ========================================
  // ğŸ“§ Ø§Ù„Ø®Ø·ÙˆØ© 7: Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø§Ù„ØªØ­Ù‚Ù‚
  // ========================================
  // Ø§Ø³ØªØ®Ø¯Ø§Ù… Event Emitter Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø¨Ø´ÙƒÙ„ ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†
  emailEvent.emit("sendConfirmEmail", { email, code });

  // ========================================
  // ğŸ« Ø§Ù„Ø®Ø·ÙˆØ© 8: Ø¥Ù†Ø´Ø§Ø¡ OTP Token
  // ========================================
  const token = generateOTPToken(String(user._id));

  // ========================================
  // ğŸª Ø§Ù„Ø®Ø·ÙˆØ© 9: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù€ Cookie
  // ========================================
  const cookieOptions = {
    httpOnly: true,     // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡ Ù…Ù† JavaScript
    secure: true,       // ÙŠØ¹Ù…Ù„ ÙÙ‚Ø· Ø¹Ù„Ù‰ HTTPS
    sameSite: "Strict", // Ø­Ù…Ø§ÙŠØ© Ù…Ù† CSRF attacks
    maxAge: 5 * 60 * 1000, // 5 Ø¯Ù‚Ø§Ø¦Ù‚
  };

  // Ø­ÙØ¸ Ø§Ù„Ù€ Token ÙÙŠ Cookie
  res.cookie("OTP_verification_token", token, cookieOptions);

  // ========================================
  // âœ… Ø§Ù„Ø®Ø·ÙˆØ© 10: Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
  // ========================================
  return res.status(201).json(
    new ApiResponse({
      message: "The account has been created successfully. Please check your email for verification.",
      status: "success",
    })
  );
};
```

---

## ğŸ” Ø¢Ù„ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/2910/2910791.png" width="150" alt="Workflow">
</div>

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙ…Ù„Ø£ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„                        â”‚
â”‚     â†“                                                    â”‚
â”‚  2. Frontend ÙŠØ±Ø³Ù„ POST Request Ù„Ù€ /signup              â”‚
â”‚     â†“                                                    â”‚
â”‚  3. Express Router ÙŠØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨                        â”‚
â”‚     â†“                                                    â”‚
â”‚  4. Validation Middleware ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª           â”‚
â”‚     â”œâ”€âŒ Ø¥Ø°Ø§ ÙØ´Ù„ â†’ Error 400 Bad Request              â”‚
â”‚     â””â”€âœ… Ø¥Ø°Ø§ Ù†Ø¬Ø­ â†’ ÙŠÙ†ØªÙ‚Ù„ Ù„Ù„ÙƒÙ†ØªØ±ÙˆÙ„Ø±                   â”‚
â”‚     â†“                                                    â”‚
â”‚  5. Controller: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙÙŠ Database           â”‚
â”‚     â”œâ”€âŒ Ù…ÙˆØ¬ÙˆØ¯ â†’ Error 409 Conflict                   â”‚
â”‚     â””â”€âœ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ â†’ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©                         â”‚
â”‚     â†“                                                    â”‚
â”‚  6. ØªØ´ÙÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù€ BCrypt                        â”‚
â”‚     â†“                                                    â”‚
â”‚  7. ØªØ´ÙÙŠØ± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ù€ CryptoJS                       â”‚
â”‚     â†“                                                    â”‚
â”‚  8. Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ MongoDB                            â”‚
â”‚     â†“                                                    â”‚
â”‚  9. ØªÙˆÙ„ÙŠØ¯ Ø±Ù…Ø² OTP (6 Ø£Ø±Ù‚Ø§Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©)                   â”‚
â”‚     â†“                                                    â”‚
â”‚  10. Ø­ÙØ¸ Ø§Ù„Ù€ OTP ÙÙŠ Ø¬Ø¯ÙˆÙ„ OTPs                          â”‚
â”‚     â†“                                                    â”‚
â”‚  11. Event Emitter ÙŠØ±Ø³Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ             â”‚
â”‚     â†“                                                    â”‚
â”‚  12. Ø¥Ù†Ø´Ø§Ø¡ OTP JWT Token                               â”‚
â”‚     â†“                                                    â”‚
â”‚  13. Ø­ÙØ¸ Ø§Ù„Ù€ Token ÙÙŠ Secure Cookie                    â”‚
â”‚     â†“                                                    â”‚
â”‚  14. Ø¥Ø±Ø¬Ø§Ø¹ Response 201 Created                        â”‚
â”‚     â†“                                                    â”‚
â”‚  15. Frontend ÙŠØ¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­                        â”‚
â”‚     â†“                                                    â”‚
â”‚  16. Frontend ÙŠÙ†ØªÙ‚Ù„ Ù„ØµÙØ­Ø© Ø¥Ø¯Ø®Ø§Ù„ OTP                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©

### **3ï¸âƒ£ User Model** - `user.model.js`

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/1183/1183672.png" width="80" alt="User Model">
</div>

```javascript
import mongoose, { Schema, model } from "mongoose";

const userSchema = new Schema({
  userName: {
    type: String,
    required: [true, 'Username is required'],
    unique: true,
    minlength: 3,
    maxlength: 30,
    trim: true
  },
  fullName: {
    type: String,
    required: [true, 'Full name is required'],
    minlength: 3,
    maxlength: 50,
    trim: true
  },
  email: {
    type: String,
    required: [true, 'Email is required'],
    unique: true,
    lowercase: true,
    trim: true,
    match: [/^\S+@\S+\.\S+$/, 'Please use a valid email address']
  },
  password: {
    type: String,
    required: [true, 'Password is required'],
    minlength: 6
  },
  phoneNumber: {
    type: String,
    required: [true, 'Phone number is required'],
    // Ù…Ø´ÙØ± Ø¨Ù€ CryptoJS
  },
  gender: {
    type: String,
    enum: ['male', 'female', 'other'],
    default: 'male'
  },
  bio: {
    type: String,
    maxlength: 500,
    default: ''
  },
  date_of_birth: {
    type: Date,
    required: false
  },
  isEmailVerified: {
    type: Boolean,
    default: false
  },
  role: {
    type: String,
    enum: ['user', 'admin'],
    default: 'user'
  },
  profileImage: {
    type: String,
    default: null
  }
}, { 
  timestamps: true // createdAt, updatedAt
});

const User = mongoose.models.User || model("User", userSchema);
export default User;
```

---

### **4ï¸âƒ£ OTP Model** - `OTP.model.js`

```javascript
import mongoose, { Schema, model } from "mongoose";

const otpSchema = new Schema({
  userId: {
    type: Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  code: {
    type: String,
    required: true,
    length: 6 // 6 Ø£Ø±Ù‚Ø§Ù…
  },
  createdAt: {
    type: Date,
    default: Date.now,
    expires: 300 // ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯ 5 Ø¯Ù‚Ø§Ø¦Ù‚ (300 Ø«Ø§Ù†ÙŠØ©)
  }
});

// Index Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹
otpSchema.index({ userId: 1, createdAt: -1 });

const OTP = mongoose.models.OTP || model("OTP", otpSchema);
export default OTP;
```

---

### **5ï¸âƒ£ Validation Middleware** - `validate.middleware.js`

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/2920/2920349.png" width="80" alt="Validation">
</div>

```javascript
/**
 * Middleware Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Joi
 * @param {Object} schema - Joi schema
 * @param {String} source - Ù…ØµØ¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (body, query, params)
 */
export const validate = (schema, source = 'body') => {
  return (req, res, next) => {
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
    const dataToValidate = req[source];

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const { error, value } = schema.validate(dataToValidate, {
      abortEarly: false, // Ø¥Ø±Ø¬Ø§Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆÙ„ÙŠØ³ Ø§Ù„Ø£ÙˆÙ„ ÙÙ‚Ø·
      stripUnknown: true // Ø­Ø°Ù Ø§Ù„Ø­Ù‚ÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø±ÙØ©
    });

    if (error) {
      // ØªÙ†Ø³ÙŠÙ‚ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
      const errors = error.details.map(err => ({
        field: err.path.join('.'),
        message: err.message
      }));

      return res.status(400).json({
        status: 'error',
        message: 'Validation failed',
        errors
      });
    }

    // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù…Ù† Joi
    req[source] = value;
    next();
  };
};
```

---

### **6ï¸âƒ£ Signup Validator** - `auth.validator.js`

```javascript
import Joi from 'joi';

export const signupSchema = Joi.object({
  userName: Joi.string()
    .min(3)
    .max(30)
    .pattern(/^[a-zA-Z0-9_]+$/) // ÙÙ‚Ø· Ø­Ø±ÙˆÙ ÙˆØ£Ø±Ù‚Ø§Ù… Ùˆ_
    .required()
    .messages({
      'string.min': 'Username must be at least 3 characters',
      'string.max': 'Username cannot exceed 30 characters',
      'string.pattern.base': 'Username can only contain letters, numbers, and underscores',
      'any.required': 'Username is required'
    }),

  fullName: Joi.string()
    .min(3)
    .max(50)
    .required()
    .messages({
      'string.min': 'Full name must be at least 3 characters',
      'any.required': 'Full name is required'
    }),

  email: Joi.string()
    .email()
    .required()
    .messages({
      'string.email': 'Please enter a valid email address',
      'any.required': 'Email is required'
    }),

  password: Joi.string()
    .min(6)
    .max(100)
    .pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/) // Ø­Ø±Ù ØµØºÙŠØ± + ÙƒØ¨ÙŠØ± + Ø±Ù‚Ù…
    .required()
    .messages({
      'string.min': 'Password must be at least 6 characters',
      'string.pattern.base': 'Password must contain uppercase, lowercase, and number',
      'any.required': 'Password is required'
    }),

  phoneNumber: Joi.string()
    .pattern(/^[0-9]{10,15}$/) // 10-15 Ø±Ù‚Ù…
    .required()
    .messages({
      'string.pattern.base': 'Please enter a valid phone number',
      'any.required': 'Phone number is required'
    }),

  gender: Joi.string()
    .valid('male', 'female', 'other')
    .default('male'),

  bio: Joi.string()
    .max(500)
    .allow('')
    .default(''),

  DOB: Joi.date()
    .max('now') // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
    .optional()
    .messages({
      'date.max': 'Date of birth cannot be in the future'
    })
});
```

---

### **7ï¸âƒ£ API Error Class** - `api-error.js`

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/2920/2920233.png" width="80" alt="Error Handling">
</div>

```javascript
/**
 * Custom Error Class Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ API
 */
class ApiError extends Error {
  constructor(message, statusCode = 500) {
    super(message);
    this.statusCode = statusCode;
    this.status = `${statusCode}`.startsWith('4') ? 'fail' : 'error';
    this.isOperational = true; // Ø£Ø®Ø·Ø§Ø¡ Ù…ØªÙˆÙ‚Ø¹Ø©

    Error.captureStackTrace(this, this.constructor);
  }
}

export default ApiError;
```

**ğŸ“Œ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:**
```javascript
// Ù…Ø«Ø§Ù„ 1: Ø®Ø·Ø£ 404
throw new ApiError("User not found", 404);

// Ù…Ø«Ø§Ù„ 2: Ø®Ø·Ø£ 409
return next(new ApiError("Email already exists", 409));

// Ù…Ø«Ø§Ù„ 3: Ø®Ø·Ø£ 401
throw new ApiError("Unauthorized access", 401);
```

---

### **8ï¸âƒ£ API Response Class** - `api-response.js`

```javascript
/**
 * Class Ù…ÙˆØ­Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª
 */
class ApiResponse {
  constructor({ 
    message, 
    status = 'success', 
    data = null, 
    meta = null 
  }) {
    this.status = status;
    this.message = message;
    
    if (data !== null) {
      this.data = data;
    }
    
    if (meta !== null) {
      this.meta = meta;
    }
  }
}

export default ApiResponse;
```

**ğŸ“Œ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:**
```javascript
// Ù…Ø«Ø§Ù„ 1: Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¨Ø³ÙŠØ·Ø©
return res.json(new ApiResponse({
  message: "Success",
  status: "success"
}));

// Ù…Ø«Ø§Ù„ 2: Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª
return res.json(new ApiResponse({
  message: "User found",
  data: { user },
  meta: { total: 1 }
}));
```

---

### **9ï¸âƒ£ Logger** - `logger.js`

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/2920/2920299.png" width="80" alt="Logger">
</div>

```javascript
import winston from 'winston';
import path from 'path';

// Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ logs Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
const logsDir = path.join(process.cwd(), 'logs');

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),
    winston.format.errors({ stack: true }),
    winston.format.splat(),
    winston.format.json()
  ),
  defaultMeta: { service: 'auth-service' },
  transports: [
    // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ error.log
    new winston.transports.File({ 
      filename: path.join(logsDir, 'error.log'), 
      level: 'error' 
    }),
    // ÙƒØªØ§Ø¨Ø© ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ combined.log
    new winston.transports.File({ 
      filename: path.join(logsDir, 'combined.log') 
    }),
  ],
});

// ÙÙŠ Ø§Ù„ØªØ·ÙˆÙŠØ±ØŒ Ø§Ø·Ø¨Ø¹ Ø¹Ù„Ù‰ Console
if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.combine(
      winston.format.colorize(),
      winston.format.simple()
    )
  }));
}

export default logger;
```

**ğŸ“Œ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:**
```javascript
import logger from '../utils/logger.js';

// Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©
logger.info('User signup attempt', { email: user.email });

// ØªØ­Ø°ÙŠØ±
logger.warn('Suspicious activity detected', { ip: req.ip });

// Ø®Ø·Ø£
logger.error('Database error', { error: err.message, stack: err.stack });
```

---

### **ğŸ”Ÿ Generate OTP Code** - `generate-code.js`

```javascript
import crypto from 'crypto';

/**
 * ØªÙˆÙ„ÙŠØ¯ Ø±Ù…Ø² OTP Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…
 * @returns {String} - Ø±Ù…Ø² Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…
 */
const generateCode = () => {
  // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† 100000 Ùˆ 999999
  return crypto.randomInt(100000, 999999).toString();
};

export default generateCode;

// Ù…Ø«Ø§Ù„ Ø¢Ø®Ø±: ØªÙˆÙ„ÙŠØ¯ OTP Ø£Ø¨Ø¬Ø¯ÙŠ Ø±Ù‚Ù…ÙŠ
export const generateAlphanumericOTP = (length = 6) => {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let otp = '';
  
  for (let i = 0; i < length; i++) {
    otp += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  
  return otp;
};
```

---

### **1ï¸âƒ£1ï¸âƒ£ Email Event System** - `email-event.js`

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/732/732200.png" width="80" alt="Email">
</div>

```javascript
import { EventEmitter } from 'events';
import nodemailer from 'nodemailer';
import logger from './logger.js';

// Ø¥Ù†Ø´Ø§Ø¡ Event Emitter
export const emailEvent = new EventEmitter();

// Ø¥Ø¹Ø¯Ø§Ø¯ Nodemailer Transporter
const transporter = nodemailer.createTransport({
  host: process.env.EMAIL_HOST, // Ù…Ø«Ø§Ù„: smtp.gmail.com
  port: process.env.EMAIL_PORT, // 587 Ø£Ùˆ 465
  secure: process.env.EMAIL_PORT === '465', // true Ù„Ù„Ù€ 465
  auth: {
    user: process.env.EMAIL_USER, // Ø¨Ø±ÙŠØ¯Ùƒ
    pass: process.env.EMAIL_PASS  // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø£Ùˆ App Password
  }
});

/**
 * Event Listener Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø§Ù„ØªØ­Ù‚Ù‚
 */
emailEvent.on('sendConfirmEmail', async ({ email, code }) => {
  try {
    const mailOptions = {
      from: `"${process.env.APP_NAME}" <${process.env.EMAIL_USER}>`,
      to: email,
      subject: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Email Verification',
      html: `
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
        <head>
          <meta charset="UTF-8">
          <style>
            body {
              font-family: Arial, sans-serif;
              background-color: #f4f4f4;
              padding: 20px;
            }
            .container {
              max-width: 600px;
              margin: 0 auto;
              background: white;
              padding: 40px;
              border-radius: 10px;
              box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            .header {
              text-align: center;
              color: #4CAF50;
              margin-bottom: 30px;
            }
            .code {
              background: #f9f9f9;
              border: 2px dashed #4CAF50;
              padding: 20px;
              text-align: center;
              font-size: 32px;
              font-weight: bold;
              letter-spacing: 10px;
              color: #333;
              margin: 30px 0;
            }
            .footer {
              text-align: center;
              color: #666;
              font-size: 14px;
              margin-top: 30px;
            }
          </style>
        </head>
        <body>
          <div class="container">
            <div class="header">
              <h1>ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ!</h1>
              <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ³Ø¬ÙŠÙ„Ùƒ ÙÙŠ Ù…Ù†ØµØªÙ†Ø§</p>
            </div>
            
            <p>ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø² Ø§Ù„ØªØ§Ù„ÙŠ Ù„ØªØ£ÙƒÙŠØ¯ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</p>
            
            <div class="code">${code}</div>
            
            <p><strong>â±ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© 5 Ø¯Ù‚Ø§Ø¦Ù‚ ÙÙ‚Ø·.</p>
            
            <p>Ø¥Ø°Ø§ Ù„Ù… ØªÙ‚Ù… Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ ØªØ¬Ø§Ù‡Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯.</p>
            
            <div class="footer">
              <p>Â© 2024 ${process.env.APP_NAME}. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            </div>
          </div>
        </body>
        </html>
      `
    };

    await transporter.sendMail(mailOptions);
    logger.info('Verification email sent successfully', { email });
    
  } catch (error) {
    logger.error('Failed to send verification email', { 
      email, 
      error: error.message 
    });
  }
});

// Event Ù„Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯
emailEvent.on('sendWelcomeEmail', async ({ email, userName }) => {
  try {
    await transporter.sendMail({
      from: `"${process.env.APP_NAME}" <${process.env.EMAIL_USER}>`,
      to: email,
      subject: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØªÙ†Ø§!',
      html: `
        <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ ${userName}! ğŸ‘‹</h1>
        <p>ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­.</p>
        <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø¬Ù…ÙŠØ¹ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ù†ØµØ©.</p>
      `
    });
    
    logger.info('Welcome email sent', { email });
  } catch (error) {
    logger.error('Failed to send welcome email', { email, error: error.message });
  }
});
```

---

### **1ï¸âƒ£2ï¸âƒ£ JWT Utils** - `jwt.js`

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/2920/2920349.png" width="80" alt="JWT">
</div>

```javascript
import jwt from 'jsonwebtoken';

/**
 * Ø¥Ù†Ø´Ø§Ø¡ OTP Token (ØµÙ„Ø§Ø­ÙŠØ© 5 Ø¯Ù‚Ø§Ø¦Ù‚)
 * ÙŠØ³ØªØ®Ø¯Ù… Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
 */
export const generateOTPToken = (userId) => {
  return jwt.sign(
    { userId, type: 'otp' },
    process.env.JWT_OTP_SECRET,
    { expiresIn: '5m' } // 5 Ø¯Ù‚Ø§Ø¦Ù‚
  );
};

/**
 * Ø¥Ù†Ø´Ø§Ø¡ Access Token (ØµÙ„Ø§Ø­ÙŠØ© Ø³Ø§Ø¹Ø©)
 * ÙŠØ³ØªØ®Ø¯Ù… Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù€ API
 */
export const generateAccessToken = (userId, role = 'user') => {
  return jwt.sign(
    { userId, role, type: 'access' },
    process.env.JWT_ACCESS_SECRET,
    { expiresIn: '1h' } // Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©
  );
};

/**
 * Ø¥Ù†Ø´Ø§Ø¡ Refresh Token (ØµÙ„Ø§Ø­ÙŠØ© 30 ÙŠÙˆÙ…)
 * ÙŠØ³ØªØ®Ø¯Ù… Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ù€ Access Token
 */
export const generateRefreshToken = (userId) => {
  return jwt.sign(
    { userId, type: 'refresh' },
    process.env.JWT_REFRESH_SECRET,
    { expiresIn: '30d' } // 30 ÙŠÙˆÙ…
  );
};

/**
 * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† OTP Token
 */
export const verifyOTPToken = (token) => {
  try {
    const decoded = jwt.verify(token, process.env.JWT_OTP_SECRET);
    
    if (decoded.type !== 'otp') {
      throw new Error('Invalid token type');
    }
    
    return decoded;
  } catch (error) {
    throw new Error('Invalid or expired OTP token');
  }
};

/**
 * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Access Token
 */
export const verifyAccessToken = (token) => {
  try {
    const decoded = jwt.verify(token, process.env.JWT_ACCESS_SECRET);
    
    if (decoded.type !== 'access') {
      throw new Error('Invalid token type');
    }
    
    return decoded;
  } catch (error) {
    throw new Error('Invalid or expired access token');
  }
};

/**
 * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Refresh Token
 */
export const verifyRefreshToken = (token) => {
  try {
    const decoded = jwt.verify(token, process.env.JWT_REFRESH_SECRET);
    
    if (decoded.type !== 'refresh') {
      throw new Error('Invalid token type');
    }
    
    return decoded;
  } catch (error) {
    throw new Error('Invalid or expired refresh token');
  }
};
```

---

## âš™ï¸ Environment Variables

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/3588/3588315.png" width="100" alt="Environment">
</div>

### **Ù…Ù„Ù `.env` Ø§Ù„ÙƒØ§Ù…Ù„:**

```env
# ========================================
# ğŸ—„ï¸ MongoDB Configuration
# ========================================
MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/ecommerce?retryWrites=true&w=majority

# ========================================
# ğŸ” Encryption & Hashing
# ========================================
SALT=10
ENCRYPT=your-crypto-secret-key-here-32chars

# ========================================
# ğŸ« JWT Secrets (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø®ØªÙ„ÙØ©!)
# ========================================
JWT_OTP_SECRET=your-otp-secret-key-minimum-32-characters
JWT_ACCESS_SECRET=your-access-secret-key-minimum-32-characters
JWT_REFRESH_SECRET=your-refresh-secret-key-minimum-32-characters

# ========================================
# ğŸ“§ Email Configuration (Gmail Example)
# ========================================
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-specific-password

# ========================================
# ğŸŒ Application Settings
# ========================================
APP_NAME=E-Commerce Platform
NODE_ENV=development
PORT=3000

# ========================================
# ğŸ“ Logger Settings
# ========================================
LOG_LEVEL=info
```

**âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©:**

1. **SALT**: Ø±Ù‚Ù… Ø¨ÙŠÙ† 10-12 (10 Ù…ÙˆØµÙ‰ Ø¨Ù‡ Ù„Ù„Ø¥Ù†ØªØ§Ø¬)
2. **ENCRYPT**: Ù…ÙØªØ§Ø­ 32 Ø­Ø±Ù Ù„Ù„Ù€ AES encryption
3. **JWT Secrets**: ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø®ØªÙ„ÙØ© ÙˆÙ‚ÙˆÙŠØ© (32+ Ø­Ø±Ù)
4. **EMAIL_PASS**: ÙÙŠ Gmail Ø§Ø³ØªØ®Ø¯Ù… App Password ÙˆÙ„ÙŠØ³ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©

---

## ğŸ”„ Ø¯Ù„ÙŠÙ„ Git Ø§Ù„Ù…ÙØµÙ„

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/4494/4494740.png" width="100" alt="Git Guide">
</div>

### **ğŸ“‹ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 1: Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„ØµÙØ±**

```bash
# ========================================
# 1ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ù‡
# ========================================

# Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
mkdir e-commerce-auth
cd e-commerce-auth

# ØªÙ‡ÙŠØ¦Ø© Git
git init
echo "# E-Commerce Auth System" >> README.md
git add README.md
git commit -m "Initial commit"

# Ø±Ø¨Ø· Ø¨Ù€ GitHub
git remote add origin https://github.com/your-username/e-commerce-auth.git
git branch -M main
git push -u origin main

# ========================================
# 2ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù„Ù‰ Main
# ========================================

# Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
mkdir -p src/{controllers,routes,models,middlewares,validators,utils}

# Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª ÙØ§Ø±ØºØ©
touch src/controllers/auth.controller.js
touch src/routes/auth.routes.js
touch src/models/{user.model.js,OTP.model.js}
touch src/middlewares/validate.middleware.js
touch src/validators/auth.validator.js
touch src/utils/{api-error.js,api-response.js,logger.js,generate-code.js,email-event.js,jwt.js}
touch src/app.js
touch .env.example
touch .gitignore

# ÙƒØªØ§Ø¨Ø© .gitignore
cat > .gitignore << EOF
node_modules/
.env
logs/
*.log
.DS_Store
EOF

# Ø¥Ù†Ø´Ø§Ø¡ package.json
npm init -y

# ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
npm install express mongoose dotenv
npm install bcryptjs crypto-js jsonwebtoken
npm install joi
npm install nodemailer
npm install winston

# Commit Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
git add .
git commit -m "Add project structure and dependencies"
git push origin main

# ========================================
# 3ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ ÙØ±Ø¹ Signup
# ========================================

# Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ÙØ±Ø¹ signup
git checkout -b signup

# Ø§Ù„Ø¢Ù† Ø§ÙƒØªØ¨ ÙƒÙ„ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª
# Ø«Ù…:

git add .
git commit -m "Add complete signup functionality with OTP"
git push -u origin signup

# ========================================
# 4ï¸âƒ£ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù€ Main
# ========================================

git checkout main
```

---

### **ğŸ“‹ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 2: Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ§Ù„Ø¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡**

```bash
# ========================================
# 1ï¸âƒ£ Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
# ========================================

git clone https://github.com/your-username/e-commerce-auth.git
cd e-commerce-auth

# Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹
git branch -a
# Output:
# * main
#   remotes/origin/HEAD -> origin/main
#   remotes/origin/main
#   remotes/origin/signup
#   remotes/origin/login

# ========================================
# 2ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ ÙØ±Ø¹ Dev Ù„Ø¬Ù…Ø¹ ÙƒÙ„ Ø´ÙŠØ¡
# ========================================

# Ø¥Ù†Ø´Ø§Ø¡ ÙØ±Ø¹ dev Ù…Ù† main
git checkout -b dev

# Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
git fetch --all

# ========================================
# 3ï¸âƒ£ Ø¯Ù…Ø¬ ÙØ±Ø¹ Signup
# ========================================

# Ø¯Ù…Ø¬ signup ÙÙŠ dev
git merge origin/signup -m "Merge signup functionality"

# Ø¥Ø°Ø§ Ø­Ø¯Ø«Øª ØªØ¹Ø§Ø±Ø¶Ø§Øª:
# 1. Ø§ÙØªØ­ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ¹Ø§Ø±Ø¶Ø©
# 2. Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª:
<<<<<<< HEAD
// ÙƒÙˆØ¯ Ù…Ù† dev
=======
// ÙƒÙˆØ¯ Ù…Ù† signup
>>>>>>> origin/signup

# 3. Ø§Ø­ØªÙØ¸ Ø¨Ù…Ø§ ØªØ±ÙŠØ¯ ÙˆØ§Ø­Ø°Ù Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
# 4. Ø«Ù…:
git add .
git commit -m "Resolve merge conflicts"

# ========================================
# 4ï¸âƒ£ Ø¯Ù…Ø¬ ÙØ±Ø¹ Login (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹)
# ========================================

git merge origin/login -m "Merge login functionality"

# Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø¥Ù† ÙˆØ¬Ø¯Øª

# ========================================
# 5ï¸âƒ£ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù… ÙˆØ§Ø®ØªØ¨Ø§Ø±
# ========================================

npm install
cp .env.example .env
# Ø¹Ø¯Ù„ .env Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
npm run dev

# ========================================
# 6ï¸âƒ£ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ ÙƒÙ„ Ø´ÙŠØ¡
# ========================================

# Ø¯Ù…Ø¬ dev ÙÙŠ main
git checkout main
git merge dev -m "Merge complete auth system"

# Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
git push origin main

# Ø±ÙØ¹ ÙØ±Ø¹ dev Ø£ÙŠØ¶Ø§Ù‹
git checkout dev
git push -u origin dev
```

---

### **ğŸ“‹ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 3: Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©**

```bash
# ========================================
# Ù…Ø«Ø§Ù„: Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© ØªØ£ÙƒÙŠØ¯ OTP
# ========================================

# Ø§Ø¨Ø¯Ø£ Ù…Ù† dev
git checkout dev
git pull origin dev

# Ø¥Ù†Ø´Ø§Ø¡ ÙØ±Ø¹ Ù„Ù„Ù…ÙŠØ²Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
git checkout -b feature/verify-otp

# Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
# Ù…Ø«Ø§Ù„: Ø¥Ø¶Ø§ÙØ© verifyOTP controller

# Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
git add .
git commit -m "Add OTP verification endpoint"
git push -u origin feature/verify-otp

# Ø¯Ù…Ø¬ ÙÙŠ dev
git checkout dev
git merge feature/verify-otp
git push origin dev

# Ø¥Ø°Ø§ ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ¹Ù…Ù„ØŒ Ø¯Ù…Ø¬ ÙÙŠ main
git checkout main
git merge dev
git push origin main
```

---

### **ğŸ› ï¸ Ø£ÙˆØ§Ù…Ø± Git Ø§Ù„Ù…ÙÙŠØ¯Ø©**

<div align="center">

| Ø§Ù„Ø£Ù…Ø± | Ø§Ù„ÙˆØµÙ | Ù…Ø«Ø§Ù„ |
|:------|:------|:-----|
| `git status` | Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„ÙØ§Øª | `git status` |
| `git log --oneline` | Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ù€ Commits | `git log --oneline --graph` |
| `git diff` | Ø¹Ø±Ø¶ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª | `git diff HEAD` |
| `git stash` | Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø¤Ù‚ØªØ§Ù‹ | `git stash save "WIP"` |
| `git stash pop` | Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª | `git stash pop` |
| `git reset` | Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Commits | `git reset --soft HEAD~1` |
| `git revert` | Ø¹ÙƒØ³ Commit Ù…Ø¹ÙŠÙ† | `git revert abc123` |
| `git cherry-pick` | Ù†Ø³Ø® Commit Ù…Ø­Ø¯Ø¯ | `git cherry-pick def456` |
| `git tag` | Ø¥Ù†Ø´Ø§Ø¡ Tag Ù„Ù„Ø¥ØµØ¯Ø§Ø± | `git tag v1.0.0` |

</div>

---

## ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/2666/2666505.png" width="100" alt="Testing">
</div>

### **1ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Signup**

```bash
# Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… cURL
curl -X POST http://localhost:3000/signup \
  -H "Content-Type: application/json" \
  -d '{
    "userName": "johndoe",
    "fullName": "John Doe",
    "email": "john@example.com",
    "password": "Pass123!",
    "phoneNumber": "01234567890",
    "gender": "male",
    "bio": "Software developer",
    "DOB": "1990-01-15"
  }'
```

**âœ… Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
```json
{
  "status": "success",
  "message": "The account has been created successfully. Please check your email for verification."
}
```

**ğŸ” ØªØ­Ù‚Ù‚ Ù…Ù†:**
- [ ] âœ… Status Code = 201
- [ ] âœ… Cookie Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Headers
- [ ] âœ… OTP ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- [ ] âœ… Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø±Ø³Ù„
- [ ] âœ… ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø´ÙØ±Ø©
- [ ] âœ… Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø´ÙØ±

---

### **2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Validation**

```bash
# Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ§Ù„Ø­
curl -X POST http://localhost:3000/signup \
  -H "Content-Type: application/json" \
  -d '{
    "userName": "test",
    "fullName": "Test",
    "email": "invalid-email",
    "password": "123",
    "phoneNumber": "123"
  }'
```

**âŒ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
```json
{
  "status": "error",
  "message": "Validation failed",
  "errors": [
    {
      "field": "email",
      "message": "Please enter a valid email address"
    },
    {
      "field": "password",
      "message": "Password must be at least 6 characters"
    },
    {
      "field": "phoneNumber",
      "message": "Please enter a valid phone number"
    }
  ]
}
```

---

### **3ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…ÙƒØ±Ø±**

```bash
# Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†ÙØ³ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø±ØªÙŠÙ†
curl -X POST http://localhost:3000/signup \
  -H "Content-Type: application/json" \
  -d '{
    "userName": "johndoe2",
    "fullName": "John Doe",
    "email": "john@example.com",
    "password": "Pass123!",
    "phoneNumber": "01234567890"
  }'
```

**âŒ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
```json
{
  "status": "fail",
  "message": "This email is already registered",
  "statusCode": 409
}
```

---

### **4ï¸âƒ£ ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**

```javascript
// ÙÙŠ MongoDB Compass Ø£Ùˆ mongosh

// 1. ÙØ­Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
db.users.findOne({ email: "john@example.com" })

// 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ´ÙÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
// ÙŠØ¬Ø¨ Ø£Ù† ØªØ¨Ø¯Ø£ Ø¨Ù€ $2b$ (BCrypt)

// 3. ÙØ­Øµ OTP
db.otps.find({ userId: ObjectId("...") }).sort({ createdAt: -1 })

// 4. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† TTL Index
db.otps.getIndexes()
// ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø± index Ø¹Ù„Ù‰ createdAt Ù…Ø¹ expireAfterSeconds: 300
```

---

### **5ï¸âƒ£ ÙØ­Øµ Ø§Ù„Ù€ Cookies**

```javascript
// ÙÙŠ Browser Console Ø¨Ø¹Ø¯ Signup

// Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ Cookies
document.cookie

// ÙŠØ¬Ø¨ Ø£Ù† ØªØ±Ù‰:
// OTP_verification_token=eyJhbGciOiJIUzI1NiIs...

// ÙØ­Øµ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù€ Cookie ÙÙŠ DevTools -> Application -> Cookies
// âœ… HttpOnly: true
// âœ… Secure: true
// âœ… SameSite: Strict
// âœ… Expires: Ø¨Ø¹Ø¯ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ù† Ø§Ù„Ø¢Ù†
```

---

### **6ï¸âƒ£ ÙØ­Øµ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ**

**ØªØ­Ù‚Ù‚ Ù…Ù†:**
- [ ] âœ… Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØµÙ„ Ù„Ù„Ù€ Inbox
- [ ] âœ… Ø±Ù…Ø² OTP Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…
- [ ] âœ… Ø§Ù„ØªØµÙ…ÙŠÙ… ØµØ­ÙŠØ­ (HTML)
- [ ] âœ… Ø§Ù„Ù…Ø±Ø³Ù„ ØµØ­ÙŠØ­

---

### **7ï¸âƒ£ ÙØ­Øµ Logs**

```bash
# Ø¹Ø±Ø¶ Ø¢Ø®Ø± 20 Ø³Ø·Ø± Ù…Ù† combined.log
tail -n 20 logs/combined.log

# ÙŠØ¬Ø¨ Ø£Ù† ØªØ±Ù‰:
# [2024-10-31 15:30:00] info: User signup attempt {"email":"john@example.com"}
# [2024-10-31 15:30:01] info: Verification email sent successfully {"email":"john@example.com"}

# ÙØ­Øµ Ø£Ø®Ø·Ø§Ø¡
tail -n 20 logs/error.log
```

---

## ğŸ› Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/2920/2920233.png" width="100" alt="Troubleshooting">
</div>

### **âŒ Ù…Ø´ÙƒÙ„Ø© 1: Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯**

**Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶:**
```
Error: Invalid login: 535-5.7.8 Username and Password not accepted
```

**Ø§Ù„Ø­Ù„:**
```bash
# 1. ØªÙØ¹ÙŠÙ„ "Less secure app access" ÙÙŠ Gmail
# Ø£Ùˆ Ø§Ù„Ø£ÙØ¶Ù„:

# 2. Ø§Ø³ØªØ®Ø¯Ø§Ù… App Password:
# - Ø§Ø°Ù‡Ø¨ Ù„Ù€ Google Account Settings
# - Security -> 2-Step Verification
# - App passwords -> Generate
# - Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù€ Password Ø§Ù„Ù…ÙˆÙ„Ø¯ ÙÙŠ .env

EMAIL_PASS=abcd efgh ijkl mnop  # Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª
```

---

### **âŒ Ù…Ø´ÙƒÙ„Ø© 2: Validation Ù„Ø§ ÙŠØ¹Ù…Ù„**

**Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶:**
```
Signup ÙŠØªÙ… Ø¨Ø¯ÙˆÙ† Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
```

**Ø§Ù„Ø­Ù„:**
```javascript
// ØªØ£ÙƒØ¯ Ù…Ù† ØªØ±ØªÙŠØ¨ Ø§Ù„Ù€ Middlewares ÙÙŠ Route

// âŒ Ø®Ø·Ø£
router.post("/signup", signup, validate(signupSchema, "body"));

// âœ… ØµØ­ÙŠØ­
router.post("/signup", validate(signupSchema, "body"), signup);
```

---

### **âŒ Ù…Ø´ÙƒÙ„Ø© 3: OTP Ù„Ø§ ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯ 5 Ø¯Ù‚Ø§Ø¦Ù‚**

**Ø§Ù„Ø­Ù„:**
```javascript
// ÙÙŠ OTP ModelØŒ ØªØ£ÙƒØ¯ Ù…Ù†:

const otpSchema = new Schema({
  // ...
  createdAt: {
    type: Date,
    default: Date.now,
    expires: 300  // âœ… 300 Ø«Ø§Ù†ÙŠØ© = 5 Ø¯Ù‚Ø§Ø¦Ù‚
  }
});

// ÙˆØªØ£ÙƒØ¯ Ù…Ù† Index:
otpSchema.index({ createdAt: 1 }, { expireAfterSeconds: 0 });
```

---

### **âŒ Ù…Ø´ÙƒÙ„Ø© 4: Cookie Ù„Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡**

**Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶:**
```
Cookie ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Browser
```

**Ø§Ù„Ø­Ù„:**
```javascript
// 1. ÙÙŠ Ø§Ù„ØªØ·ÙˆÙŠØ±ØŒ ØºÙŠØ± secure Ù„Ù€ false
const cookieOptions = {
  httpOnly: true,
  secure: false,  // âœ… false ÙÙŠ Ø§Ù„ØªØ·ÙˆÙŠØ±
  sameSite: "Lax", // âœ… Lax Ø£ÙØ¶Ù„ ÙÙŠ Ø§Ù„ØªØ·ÙˆÙŠØ±
  maxAge: 5 * 60 * 1000,
};

// 2. ØªØ£ÙƒØ¯ Ø£Ù† Frontend Ùˆ Backend Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù€ Domain
// Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… CORS settings:

app.use(cors({
  origin: 'http://localhost:3000',
  credentials: true  // âœ… Ù…Ù‡Ù… Ù„Ù„Ù€ Cookies
}));
```

---

### **âŒ Ù…Ø´ÙƒÙ„Ø© 5: Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ø§ ÙŠÙÙƒ ØªØ´ÙÙŠØ±Ù‡**

**Ø§Ù„Ø­Ù„:**
```javascript
// Ù„ÙÙƒ ØªØ´ÙÙŠØ± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:

import CryptoJS from 'crypto-js';

const decryptedPhone = CryptoJS.AES.decrypt(
  user.phoneNumber,
  process.env.ENCRYPT
).toString(CryptoJS.enc.Utf8);

console.log(decryptedPhone); // 01234567890
```

---

## ğŸ“Š Package.json Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

```json
{
  "name": "e-commerce-auth",
  "version": "2.0.0",
  "description": "Advanced authentication system with OTP verification",
  "main": "src/app.js",
  "type": "module",
  "scripts": {
    "start": "node src/app.js",
    "dev": "nodemon src/app.js",
    "test": "jest",
    "lint": "eslint src/"
  },
  "keywords": ["auth", "jwt", "otp", "email-verification"],
  "author": "Mohamed Developer",
  "license": "MIT",
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^7.5.0",
    "bcryptjs": "^2.4.3",
    "crypto-js": "^4.2.0",
    "jsonwebtoken": "^9.0.2",
    "joi": "^17.11.0",
    "nodemailer": "^6.9.7",
    "winston": "^3.11.0",
    "dotenv": "^16.3.1",
    "cookie-parser": "^1.4.6",
    "cors": "^2.8.5"
  },
  "devDependencies": {
    "nodemon": "^3.0.1",
    "jest": "^29.7.0",
    "eslint": "^8.52.0"
  }
}
```

---

## ğŸ¯ Ø§Ù„Ø®Ù„Ø§ØµØ© ÙˆØ§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©

<div align="center">
<img src="https://cdn-icons-png.flaticon.com/512/5968/5968836.png" width="100" alt="Success">
</div>

### **âœ… Ù…Ø§ ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡:**

- [x] Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø´Ø§Ù…Ù„ Ø¨Ù€ 8 Ø­Ù‚ÙˆÙ„
- [x] ØªØ´ÙÙŠØ± Ù…ØªÙ‚Ø¯Ù… (BCrypt + CryptoJS)
- [x] Ù†Ø¸Ø§Ù… OTP ÙƒØ§Ù…Ù„
- [x] Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
- [x] JWT Tokens (3 Ø£Ù†ÙˆØ§Ø¹)
- [x] Validation Ø§Ø­ØªØ±Ø§ÙÙŠ
- [x] Error Handling Ø´Ø§Ù…Ù„
- [x] Logging System
- [x] Secure Cookies

### **ğŸ”® Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:**

1. **Ø¥Ø¶Ø§ÙØ© Verify OTP Endpoint**
```javascript
router.post("/verify-otp", verifyOTP);
```

2. **Ø¥Ø¶Ø§ÙØ© Resend OTP**
```javascript
router.post("/resend-otp", resendOTP);
```

3. **Ø¥Ø¶Ø§ÙØ© Login Controller**
```javascript
router.post("/login", login);
```

4. **Ø¥Ø¶Ø§ÙØ© Logout**
```javascript
router.post("/logout", logout);
```

5. **Ø¥Ø¶Ø§ÙØ© Refresh Token**
```javascript
router.post("/refresh-token", refreshAccessToken);
```

---

<div align="center">

### ğŸ“ Signup System v2.0.0

**Ø¢Ù…Ù† â€¢ Ù…ØªÙ‚Ø¯Ù… â€¢ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ù†ØªØ§Ø¬**

---

**Branch:** `signup`  
**Status:** âœ… Production Ready  
**Last Updated:** November 2024

**Created by:** Mohamed Developer

[![Back to Main](https://img.shields.io/badge/Back_to-Main_README-blue?style=for-the-badge)](../README.md)
[![Login Branch](https://img.shields.io/badge/View-Login_Branch-success?style=for-the-badge)](../login/README.md)
[![Report Issue](https://img.shields.io/badge/Report-Issue-red?style=for-the-badge)](https://github.com/your-repo/issues)

**â­ Ø¥Ø°Ø§ Ø£Ø¹Ø¬Ø¨Ùƒ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ Ù„Ø§ ØªÙ†Ø³Ù Ø¥Ø¶Ø§ÙØ© Ù†Ø¬Ù…Ø© Ø¹Ù„Ù‰ GitHub!**

</div>
